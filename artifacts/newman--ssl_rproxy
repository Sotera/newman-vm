#
# Proxy newman from port 80
# Basic proxy config
# Remove this server section if you need to secure access through https
# WARNING:  REMOVE THIS SECTION IN PRODUCTION!
# 
server {
    listen 80;
    server_name  127.0.0.1;
    access_log            /var/log/nginx/newman.80.access.log;
    location / {
        root /var/www/newman/;
        proxy_set_header X-Forwarded-Host $host:$server_port;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://127.0.0.1:5000;
    }
}


#
# Redirect all traffic from port 80 to 443 over https
# Remove above section and uncomment this section to activate redirect
#
#server {
#    listen 80;
#    return 301 https://$host$request_uri;
#}


#
# Proxy newman via https
# You will need to create a cert or preferably register with CA etc.
#
#e.g.
# cd /etc/nginx
# sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/cert.key -out /etc/nginx/cert.crt
#
server {
    listen 443;    
    server_name  127.0.0.1;

    ssl_certificate           /etc/nginx/cert.crt;
    ssl_certificate_key       /etc/nginx/cert.key;

    ssl on;
    ssl_session_cache  builtin:1000  shared:SSL:10m;
    ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4;
    ssl_prefer_server_ciphers on;

    access_log            /var/log/nginx/newman.443.access.log;


    location / {
        root /var/www/newman/;
        proxy_set_header X-Forwarded-Host $host:$server_port;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://127.0.0.1:5000;
    }
}


